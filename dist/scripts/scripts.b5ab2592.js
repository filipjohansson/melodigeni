"use strict";angular.module("melodigeniAppApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(t){t.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/fragor",{templateUrl:"views/fragor.html",controller:"FragorCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("melodigeniAppApp").controller("MainCtrl",["$scope","$location","$sce","sr","lastfm",function(a,t,e,r,n){var i=0;function o(t){for(var e,r,n=t.length;0!==n;)r=Math.floor(Math.random()*n),e=t[n-=1],t[n]=t[r],t[r]=e;return t}function s(){0==i?n.getArtistInfo(a.currentlyPlaying.artist).then(function(t){u("artistName",t)}):1==i?n.getArtistInfo(a.currentlyPlaying.artist).then(function(t){u("yearFormed",t)}):2==i?n.getArtistInfo(a.currentlyPlaying.artist).then(function(t){u("artistImage",t)}):3==i&&n.getArtistInfo(a.currentlyPlaying.artist).then(function(t){a.artistResult=t}),i++}r.getChannels().then(function(t){a.channels=t});var l=[];function c(t,e){e=parseInt(e);var r=Math.floor(10*Math.random()-5),n=parseInt(e+r),a=parseInt((new Date).getFullYear());return~l.indexOf(n)||n==a||n==e?c(t,e):(l.push(n),n)}function u(t,e){if("artistName"===t){(n=new Array).push({text:e.artist.name,correct:!0});for(var r=0;r<=2;r++)n.push({text:e.artist.similar.artist[r].name,correct:!1});a.question={question:"Vad heter artisten?",answers:o(n)}}else if("yearFormed"===t){void 0===e.artist.bio.yearformed&&s(),(n=new Array).push({text:e.artist.bio.yearformed,correct:!0});for(r=0;r<=2;r++)n.push({text:c(n,e.artist.bio.yearformed),correct:!1});a.question={question:"Vilket år började "+a.currentlyPlaying.artist+"?",answers:o(n)}}else if("artistImage"===t){var n;(n=new Array).push({image:e.artist.image[4]["#text"],correct:!0});for(r=0;r<=2;r++)n.push({image:e.artist.similar.artist[r].image[4]["#text"],correct:!1});a.question={question:"Hur ser "+a.currentlyPlaying.artist+" ut?",answers:o(n)}}}a.selectChannel=function(t){a.currentChannel=t,r.getCurrentlyPlaying(t.id).then(function(t){a.currentlyPlaying={},a.currentlyPlaying.artist=t.playlist.song.artist,a.currentlyPlaying.title=t.playlist.song.title,s()})},a.checkAnswer=function(t){t.correct?(console.info("Rätt svar!"),s()):console.info("Fel svar!"),a.question.answers[a.question.answers.indexOf(t)].selected=!0},a.renderHtml=function(t){return e.trustAsHtml(t)},a.reloadPage=function(){window.location.reload()}}]),angular.module("melodigeniAppApp").controller("AboutCtrl",["$scope",function(t){t.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("melodigeniAppApp").service("sr",["$q","$http",function(r,n){function a(t){var e=r.defer();return-1<t.indexOf("?")?t+="&format=json&callback=JSON_CALLBACK&pagination=false":t+="?format=json&callback=JSON_CALLBACK&pagination=false",n.jsonp(t).success(function(t){t,e.resolve(t)}),e.promise}return{getChannels:function(){var e=r.defer();return a("https://api.sr.se/api/v2/channels").then(function(t){e.resolve(t)}),e.promise},getCurrentlyPlaying:function(t){var e=r.defer();return a("https://api.sr.se/api/v2/playlists/rightnow?channelid="+t).then(function(t){e.resolve(t)}),e.promise}}}]),angular.module("melodigeniAppApp").service("lastfm",["$q","$http",function(r,n){var a="b3786a8ea8b3e571d0c6415b8b723c49";return{getArtistInfo:function(t){var e=r.defer();return function(t){var e=r.defer();return t=-1<t.indexOf("?")?t+"&api_key="+a+"&format=json&callback=JSON_CALLBACK":t+"?api_key="+a+"&format=json&callback=JSON_CALLBACK",n.jsonp(t).success(function(t){t,e.resolve(t)}),e.promise}("https://ws.audioscrobbler.com/2.0/?method=artist.getInfo&artist="+t).then(function(t){e.resolve(t)}),e.promise}}}]);